(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-99a3bd86"],{"57e0":function(t,e,n){"use strict";n("928f")},"928f":function(t,e,n){},"957a":function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"page"},[n("div",{staticClass:"searchWrap"},[n("div",{staticClass:"search"},[n("table",[n("tr",[n("td",[t._v("\n                          角色名称\n                        "),[n("Input",{staticStyle:{width:"150px"},attrs:{clearable:"",placeholder:"请输入角色名称"},model:{value:t.searchInfo.name,callback:function(e){t.$set(t.searchInfo,"name",e)},expression:"searchInfo.name"}})],[n("div",{staticClass:"searchBtnList"},[n("Button",{attrs:{type:"primary",icon:"ios-add-circle"},on:{click:t.showNew}},[t._v("新增")]),n("Button",{attrs:{icon:"ios-refresh-circle"},on:{click:t.reflesh}},[t._v("重置")])],1)]],2)])])])]),n("div",{staticClass:"tableList"},[[n("Table",{attrs:{height:t.height-100,border:"",stripe:"",loading:t.isLoading,columns:t.columnsRealTime,data:t.realTimeDataList},scopedSlots:t._u([{key:"action",fn:function(e){var i=e.row;e.index;return[n("Button",{attrs:{type:"warning",size:"small"},on:{click:function(e){return t.showRoleFunctions(i)}}},[t._v("权限设置")]),t._v("  \n                    "),n("Button",{attrs:{type:"primary",size:"small"},on:{click:function(e){return t.showEdit(i)}}},[t._v("修改")]),t._v("  \n                    "),n("Button",{attrs:{type:"error",size:"small"},on:{click:function(e){return t.deleteAction(i)}}},[t._v("删除")])]}}])})]],2),n("div",{staticClass:"pageWrap"},[[n("Page",{attrs:{total:t.count,"page-size":50,"page-size-opts":[50,100,150],"show-sizer":"",showTotal:""},on:{"on-change":t.pageSizeChange,"on-page-size-change":t.pageRowChange}})]],2),[n("Modal",{staticClass:"noContentPadding noHeaderModal",attrs:{"mask-closable":!1,width:"30",styles:{top:"5%"},title:"角色录入"},on:{"on-cancel":function(e){t.isDetail=!1}},model:{value:t.isDetail,callback:function(e){t.isDetail=e},expression:"isDetail"}},[n("div",{staticClass:"modalTable"},[n("div",{staticClass:"detail"},[n("table",[n("tr",[n("td",[n("span",{staticClass:"request"},[t._v("*")]),t._v("角色名称：\n                                "),n("div",[n("Input",{staticStyle:{width:"100%"},attrs:{placeholder:"填写角色名称,2~8为字符"},model:{value:t.itemInfo.name,callback:function(e){t.$set(t.itemInfo,"name",e)},expression:"itemInfo.name"}})],1)])]),n("tr",[n("td",[t._v("\n                                角色描述：\n                                "),n("div",[n("Input",{staticStyle:{width:"100%"},attrs:{placeholder:"填写角色描述"},model:{value:t.itemInfo.description,callback:function(e){t.$set(t.itemInfo,"description",e)},expression:"itemInfo.description"}})],1)])])])])]),n("div",{staticClass:"modalFooter",attrs:{slot:"footer"},slot:"footer"},[[n("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"default"},on:{click:function(e){t.isDetail=!1}}},[t._v("关闭")]),n("Button",{attrs:{type:"primary",disable:t.disable},on:{click:t.saveAction}},[t._v("提交")])]],2)])],[n("Modal",{staticClass:"noContentPadding",attrs:{"mask-closable":!1,"footer-hide":!0,width:"70",styles:{top:"5%"},title:"角色权限"},on:{"on-cancel":function(e){t.isFunction=!1}},model:{value:t.isFunction,callback:function(e){t.isFunction=e},expression:"isFunction"}},[n("Row",[n("Col",{attrs:{span:"8"}},[n("div",{staticClass:"searchWrap",staticStyle:{"min-height":"auto"}},[n("div",{staticClass:"search"},[n("table",[n("tr",[n("td",[n("span",{staticStyle:{"font-size":"16px"}},[t._v("权限列表")]),[n("div",{staticClass:"searchBtnList"},[n("Button",{attrs:{type:"primary",size:"small",disabled:0==t.selectFunction.length},on:{click:t.uploadFunctionDataToServer}},[t._v("添加")])],1)]],2)])])])]),n("div",{staticStyle:{position:"relative","z-index":"0",height:"350px",overflow:"auto",padding:"0 10px"}},[n("Tree",{attrs:{data:t.functionsTableRowList,"show-checkbox":""},on:{"on-check-change":t.selectFunctionsChange}})],1)]),n("Col",{attrs:{span:"16"}},[n("div",{staticClass:"searchWrap",staticStyle:{"min-height":"auto"}},[n("div",{staticClass:"search"},[n("table",[n("tr",[n("td",[n("span",{staticStyle:{"font-size":"16px"}},[t._v("绑定的权限")]),[n("div",{staticClass:"searchBtnList"},[n("Button",{attrs:{type:"error",disabled:0==t.selectRoleFunction.length,size:"small"},on:{click:t.deleteRoleFunctions}},[t._v("删除")])],1)]],2)])])])]),n("div",{staticClass:"tableList"},[[n("Table",{attrs:{height:300,border:"",stripe:"",loading:t.isModalLoading,columns:t.roleFunctionColumsList,data:t.roleFunctionTableRowList},on:{"on-selection-change":t.selectRoleFunctionsChange}})]],2),n("div",{staticClass:"pageWrap"},[[n("Page",{attrs:{total:t.roleFunctionPageInfo.count,"page-size":50,"page-size-opts":[50,100,150],"show-sizer":"",showTotal:""},on:{"on-change":t.pageSizeChange,"on-page-size-change":t.pageRowChange}})]],2)])],1)],1)]],2)},o=[],a=(n("8dee"),n("a450"),{name:"role",components:{},data:function(){return{userInfo:null,height:window.innerHeight,isModalLoading:!1,isDetail:!1,isFunction:!1,isInfo:!1,disable:!1,isLoading:!1,count:0,pageInfo:{pageIndex:0,pageSize:50},searchInfo:{name:""},itemInfo:{id:"",description:"",menu_auth:"",name:""},columnsRealTime:[{align:"center",title:"序号",type:"index",width:60},{title:"角色名称",align:"center",key:"name"},{title:"角色描述",align:"center",key:"description"},{align:"center",title:"操作",width:220,slot:"action"}],realTimeDataList:[],companyList:[],roleFunctionPageInfo:{count:0,pageNum:1,pageSize:20,roleId:"",companyId:""},roleFunctionColumsList:[{type:"selection",width:60,align:"center"},{title:"公司名称",align:"center",key:"companyName",width:250},{title:"角色名称",align:"center",key:"roleName"},{title:"功能名称",align:"center",key:"functionName"}],roleFunctionTableRowList:[],functionsTableRowList:[],selectFunction:[],selectRoleFunction:[]}},methods:{pageSizeChange:function(t){var e=this;e.pageInfo.pageIndex=parseInt(t,10),e.getList(!0)},pageRowChange:function(t){var e=this;e.pageInfo.pageSize=parseInt(t,10),e.getList(!1)},reflesh:function(){var t=this;t.getList(!0)},getList:function(t){var e=this;1==t&&(e.isLoading=!0,e.pageInfo.pageIndex=0),e.axios({method:"get",url:e.$config.action.roleList,params:{pageNum:e.pageInfo.pageIndex,pageSize:e.pageInfo.pageSize}}).then((function(t){e.realTimeDataList=t.data.list,e.count=t.data.count,"0"==t.data.code?(e.realTimeDataList=t.data.list,e.count=t.data.count):"9003"==t.data.code?e.utility.loginTimeOut(e):e.$Message.error(t.data.msg),e.isLoading=!1})).catch((function(t){console.log(t),e.isLoading=!1}))},showNew:function(){var t=this;t.itemInfo={id:"",description:"",menu_auth:"",name:""},t.itemInfo.companyId=t.companyList[0]?t.companyList[0]["id"]:"",t.isDetail=!0},showEdit:function(t){var e=this;for(var n in t)e.itemInfo[n]=t[n];e.isDetail=!0},showInfo:function(t){var e=this;for(var n in t)e.itemInfo[n]=t[n];e.isInfo=!0},saveAction:function(){var t=this;0!=t.itemInfo.name.trim().length?(t.disable=!0,t.axios({method:"post",url:t.itemInfo.id?t.$config.action.roleEdit:t.$config.action.roleAdd,data:{id:t.itemInfo.id||0,description:t.itemInfo.description,menu_auth:t.itemInfo.menu_auth,name:t.itemInfo.name}}).then((function(e){"0"==e.data.code?(t.$Message.success("提交成功"),t.getList(!1),t.isDetail=!1,t.itemInfo={id:"",companyId:"",roleName:"",roleCode:"",roleDesc:"",isValid:1,isPublic:1,createUserId:"",modifyUserId:""}):"9003"==e.data.code?t.utility.loginTimeOut(t):t.$Message.error(e.data.msg),t.disable=!1})).catch((function(e){console.log(e),t.disable=!1}))):t.$Message.error("请输入角色名称")},deleteAction:function(t){var e=this;e.$Modal.confirm({title:"确定删除"+t.name+"?",onOk:function(){e.axios({method:"post",url:e.$config.action.roleDelete,data:{id:t.id}}).then((function(t){"0"==t.data.code?(e.$Message.success("删除成功"),e.getList(!0)):"9003"==t.data.code?e.utility.loginTimeOut(e):e.$Message.error(t.data.msg)})).catch((function(t){console.log(t)}))}})},enableOrNot:function(t,e){var n=this;n.axios({method:"post",headers:{token:n.userInfo.token},url:1==t?n.$config.action.roleEnable:n.$config.action.roleDisable,data:{id:e.id}}).then((function(t){"0"==t.data.code?(n.$Message.success("修改成功"),n.getList(!1)):"419"==t.data.code?n.$utility.loginTimeOut(n):n.$Message.error(t.data.msg)})).catch((function(t){console.log(t)}))},showRoleFunctions:function(t){var e=this;e.roleFunctionPageInfo.companyId=t.companyId,e.roleFunctionPageInfo.roleId=t.id,e.isFunction=!0,e.getFunctionsDataList(),e.getRoleFunctionsDataList(!0)},roleFunctionsPageSizeChange:function(t){var e=this;e.roleFunctionPageInfo.pageNum=parseInt(t,10),setTimeout((function(){e.getRoleFunctionsDataList(!1)}),200)},roleFunctionsPageRowChange:function(t){var e=this;e.roleFunctionPageInfo.pageSize=parseInt(t,10),setTimeout((function(){e.getRoleFunctionsDataList(!1)}),200)},getRoleFunctionsDataList:function(t){var e=this;1==t&&(e.roleFunctionPageInfo.pageNum=1),e.isModalLoading=!0,e.axios({method:"post",headers:e.$utility.setHeader(e.$config.service.permissionService),url:e.$config.action.getRoleFunctionList,data:e.$qs.stringify({pageNum:e.roleFunctionPageInfo.pageNum,pageSize:e.roleFunctionPageInfo.pageSize,companyId:e.roleFunctionPageInfo.companyId,roleId:e.roleFunctionPageInfo.roleId})}).then((function(t){"0"==t.data.code?(e.roleFunctionTableRowList=t.data.data,e.roleFunctionPageInfo.count=t.data.count):"9003"==t.data.code?e.utility.loginTimeOut(e):e.$Message.error(t.data.msg),e.isModalLoading=!1})).catch((function(t){console.log(t),e.isModalLoading=!1}))},setChecked:function(){for(var t=this,e=0,n=t.roleFunctionTableRowList.length;e<n;e++)t.getSuper(t.functionsTableRowList,t.roleFunctionTableRowList[e]["functionId"])},selectFunctionsChange:function(t){for(var e=this,n=[],i=0,o=t.length;i<o;i++)n.push(t[i]["id"]);e.selectFunction=n},formatFunctions:function(t){var e=this,n=JSON.stringify(t).replace(/(subFunctionList)/g,"children").replace(/(functionName)/g,"title").replace(/isValid/g,"expand");e.functionsTableRowList=JSON.parse(n),console.log(e.functionsTableRowList),e.setChecked()},getFunctionsDataList:function(t){var e=this;e.functionsTableRowList=[],e.axios({method:"post",headers:e.$utility.setHeader(e.$config.service.permissionService),url:e.$config.action.getFunctionTreeList,data:e.$qs.stringify({pageNum:1,pageSize:1e5})}).then((function(t){"0"==t.data.code?e.formatFunctions(t.data.data):"9003"==t.data.code?e.utility.loginTimeOut(e):e.$Message.error(t.data.msg)})).catch((function(t){console.log(t)}))},uploadFunctionDataToServer:function(){var t=this;t.axios({method:"post",headers:t.$utility.setHeader(t.$config.service.permissionService),url:t.$config.action.saveRoleFunction,data:t.$qs.stringify({roleId:t.roleFunctionPageInfo.roleId,companyId:t.roleFunctionPageInfo.companyId,functionIds:t.selectFunction.join(","),createUserId:t.userInfo["id"],modifyUserId:t.userInfo["id"]})}).then((function(e){"0"==e.data.code?t.getRoleFunctionsDataList(!0):"9003"==e.data.code?t.utility.loginTimeOut(t):t.$Message.error(e.data.msg)})).catch((function(t){console.log(t)}))},selectRoleFunctionsChange:function(t){for(var e=this,n=[],i=0,o=t.length;i<o;i++)n.push(t[i]["id"]);e.selectRoleFunction=n},deleteRoleFunctions:function(){var t=this;t.isModalLoading=!0,t.axios({method:"post",headers:t.$utility.setHeader(t.$config.service.permissionService),url:t.$config.action.delRoleFunction,data:t.$qs.stringify({ids:t.selectRoleFunction.join(","),modifyUserId:t.userInfo["id"]})}).then((function(e){"0"==e.data.code?t.getRoleFunctionsDataList(!0):"9003"==e.data.code?t.utility.loginTimeOut(t):t.$Message.error(e.data.msg)})).catch((function(t){console.log(t)}))}},created:function(){var t=this,e=null;t.userInfo=t.$utility.getLocalStorage("userInfo"),t.getList(!0),t.$watch("searchInfo",(function(){clearTimeout(e),e=setTimeout((function(){t.getList(!0)}),200)}),{deep:!0})},mounted:function(){var t=this,e=null;window.onresize=function(){clearTimeout(e),e=setTimeout((function(){t.height=window.innerHeight}),500)}},beforeDestroy:function(){clearInterval(window.recordTime)}}),s=a,c=(n("57e0"),n("5d22")),l=Object(c["a"])(s,i,o,!1,null,null,null);e["default"]=l.exports}}]);
//# sourceMappingURL=chunk-99a3bd86.db62eef5.js.map